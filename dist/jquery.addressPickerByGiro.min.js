!function(e){"use strict";function t(e,t,n){clearTimeout(s[n]),s[n]=setTimeout(e,t)}function n(t){var n,a=this,t=t||this.addressMapping[this.$element.val()];t&&e.each(this.settings.boundElements,function(i,r){if(!e(i))return!0;n=e(i);var s="";e.isFunction(r)?s=e.proxy(r,a)(t):t.cleanData&&t.cleanData[r]&&(s=t.cleanData[r]),n.each(function(){var t="val",n=e(this);n.is("input, select, textarea")||(t="text"),n[t](s)})})}function a(){var t=this,n=e.extend({},t.settings.mapOptions);n.center=new google.maps.LatLng(n.center[0],n.center[1]);var a={position:n.center,draggable:!0,raiseOnDrag:!0,map:t.gmap,labelContent:t.settings.text.you_are_here,labelAnchor:new google.maps.Point(0,0),labelClass:t.settings.markerLabelClass,labelStyle:{opacity:1}};if("styled"==t.settings.markerType&&"function"==typeof StyledMarker){var i=new StyledIcon(StyledIconTypes.BUBBLE,{color:"#51A351",fore:"#ffffff",text:t.settings.text.you_are_here});a.styleIcon=i,t.gmarker=new StyledMarker(a)}else t.gmarker="labeled"==t.settings.markerType&&"function"==typeof MarkerWithLabel?new MarkerWithLabel(a):new google.maps.Marker(a);google.maps.event.addListener(t.gmarker,"dragend",function(){t.geocodeLookup(t.gmarker.getPosition(),!1,"latLng",!0)}),google.maps.event.addListener(t.gmap,"click",function(e){t.gmarker.setPosition(e.latLng),t.geocodeLookup(e.latLng,!1,"latLng",!0)}),this.gmarker.setVisible(!1)}function i(){var t,n=this,a=e.extend({},n.settings.mapOptions);a.center=new google.maps.LatLng(a.center[0],a.center[1]),t&&(t=1e3*t),t=t||n.settings.distanceWidgetRadius;var i=new google.maps.Circle({center:a.center,radius:t,strokeColor:"#005DE0",strokeOpacity:.8,strokeWeight:2,fillColor:"#005DE0",fillOpacity:.25,map:n.gmap}),r=function(){i.setEditable(!0)},s=function(){i.setEditable(!1)};n.gcircle=i,n.gcircle.setVisible(!1),google.maps.event.addListener(n.gcircle,"radius_changed",function(){n.updater()}),google.maps.event.addListener(n.gcircle,"mouseover",r),google.maps.event.addListener(n.gcircle,"mouseout",s),n.gcircle.bindTo("center",n.gmarker,"position")}var r,s={};r={init:function(t,n){var a=this;a.$element=t,a.settings=e.extend(!0,{map:!1,mapId:!1,mapWidth:"100%",mapHeight:"250px",mapOptions:{zoom:3,center:[51.751724,-1.255284],scrollwheel:!1,mapTypeId:"roadmap"},makerType:!1,distanceWidget:!1,distanceWidgetRadius:3e4,appendToAddressString:"",geocoderOptions:{language:"en"},typeaheadOptions:{source:a.source,updater:a.updater,matcher:a.matcher},boundElements:{},text:{you_are_here:"You are here!"},map_rendered:!1},n),e.each(a.settings.typeaheadOptions,function(t,n){e.isFunction(a.settings.typeaheadOptions[t])&&(a.settings.typeaheadOptions[t]=e.proxy(n,a))}),a.addressMapping={},a.currentItem="",a.geocoder=new google.maps.Geocoder,a.initMap.apply(a,void 0),a.$element.attr("autocomplete","off").typeahead(a.settings.typeaheadOptions),""!=a.$element.val()&&a.geocodeLookup(a.$element.val(),!1,"",!0)},initMap:function(){var t,n=this;if(n.settings.mapId||n.settings.map instanceof google.maps.Map?t=e(n.settings.mapId):(n.settings.mapId=(new Date).getTime()+Math.floor(9999999*Math.random()+1),t=e('<div style="margin: 5px 0; width: '+n.settings.mapWidth+"; height: "+n.settings.mapHeight+';" id="'+n.settings.mapId+'"></div>'),n.$element.after(t)),1==n.map_rendered)return void n.resizeMap();var r=e.extend({},n.settings.mapOptions);this.settings.map instanceof google.maps.Map?this.gmap=this.settings.map:(r.center=new google.maps.LatLng(r.center[0],r.center[1]),this.gmap=new google.maps.Map(t[0],r)),a.call(this),this.settings.distanceWidget&&i.call(this),n.map_rendered=!0},source:function(n,a){var i,r=this;t(function(){r.geocodeLookup(n,function(t){return r.addressMapping={},i=[],e.each(t,function(e,t){r.addressMapping[t.formatted_address]=t,i.push(t.formatted_address)}),a(i)})},250,"source")},updater:function(e){var t,a=this,e=e||a.$element.val(),i=this.addressMapping[e]||{},r={},s=i.geometry.location;if(i){if(t={country:{long_name:"country",short_name:"country_code"},administrative_area_level_1:{long_name:"region",short_name:"region_code"},administrative_area_level_2:{long_name:"county",short_name:"county_code"},locality:{long_name:"city"},sublocality:{long_name:"city_district"},postal_code:{long_name:"zip"},route:{long_name:"street"},street_number:{long_name:"street_number"}},i.address_components)for(var o=0;o<i.address_components.length;o++){var d=i.address_components[o];for(var g in t)if(d.types.indexOf(g)>=0)for(var c in t[g])"undefined"!=typeof d[c]&&(r[t[g][c]]=d[c])}return r.latitude=Number(s.lat().toFixed(8)),r.longitude=Number(s.lng().toFixed(8)),r.formatted_address=i.formatted_address,a.gmarker&&(a.gmarker.setPosition(i.geometry.location),a.gmarker.setVisible(!0)),a.gcircle&&(a.gcircle.setCenter(i.geometry.location),a.gcircle.setVisible(!0),r.radius=Math.round(a.gcircle.getRadius())/1e3),a.gmap.fitBounds(a.gcircle?a.gcircle.getBounds():i.geometry.viewport),i.cleanData=r,n.call(a,i),a.$element.trigger("selected.addressPickerByGiro",i),e}},matcher:function(){return!0},currentAddress:function(){return this.addressMapping[this.$element.val()]||{}},geocodeLookup:function(t,n,a,i){i=i||!1,a=a||"";var r=this,s=e.extend({},r.settings.geocoderOptions);"latLng"==a?("string"==typeof t&&(t=t.split(","),t=new google.maps.LatLng(t[0],t[1])),s.latLng=t):s.address=t+r.settings.appendToAddressString,this.geocoder.geocode(s,function(t,a){if(a===google.maps.GeocoderStatus.OK&&(e.isFunction(n)&&n.call(r,t),i)){var s=t[0].formatted_address;r.$element.val(s),r.addressMapping[s]=t[0],r.updater(s)}})},resizeMap:function(n,a){var i=this;t(function(){var t,r=i.mapContainer?e(i.mapContainer):e("#"+i.mapId).parent();if(r.length){var s=r.parent(),o=s.height();w=s.width(),r.css("height",o),r.css("width",w),t="undefined"!=typeof n&&"undefined"!=typeof a?new google.maps.LatLng(n,a):i.gmap.getCenter(),google.maps.event.trigger(i.gmap,"resize"),i.gmap.setCenter(t)}},300,"resize")},setRadius:function(e){var t=this;t.gcircle&&(t.gcircle.setRadius(1e3*e),t.gmap.fitBounds(t.gcircle.getBounds()))}},e.fn.addressPickerByGiro=function(t){var n=this,a=this.data("addressPickerByGiro");return a?"string"==typeof t&&a[t]?a[t].apply(a,Array.prototype.slice.call(arguments,1)):e.error("Method "+t+" does not exist on jQuery.addressPickerByGiro"):t&&"object"!=typeof t?e.error('jQuery.addressPickerByGiro is not instantiated. Please call $("selector").addressPickerByGiro({options})'):this.each(function(){var a;a=e.extend({},r),a.init(n,t),n.data("addressPickerByGiro",a)})}}(jQuery);